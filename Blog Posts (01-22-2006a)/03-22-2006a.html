<link href="style.css" rel="stylesheet" type="text/css" />
<p><strong>Anatomy of a ColdFusion Cluster  </strong></p>
<p>Clustering with ColdFusion can be done using JRun however JRun lacks some level of robustness that one may find desirable when building and deploying a Cluster of ColdFusion Servers.</p>
<p><a href="drawings/ColdFusion_Cluster_(03-21-2006).htm" target="_blank">Take a look at this Diagram</a>.  </p>
<p>This Diagram shows a cluster of 3 ColdFusion servers and 1 SQL Server 2005 server.</p>
<p>JRun Clustering is not being used. This may seem like a strange way to architect a ColdFusion Cluster but then we have seen some strange architectures for doing this same thing that didn't use JRun to do the clustering.</p>
<p>One Benefit of not using JRun to do the clustering is that the Traffic Reflector Server can handle the situation when both Server #1 and Server #2 (ColdFusion servers) are down or non-responsive in which case the Traffic Reflector can easily display a nice looking web page to the user to tell the user that the site is down for Maintenance rather than the more typical HTTP 404 error that can result from a requested page being unavailable.</p>
<p>When the Traffic Refector Server chooses a target server it also flags the Client Scope with the name of the target server to facilitate the next request the user may make. The Client Scope for this user is then made available to both Server #1 and Server #2 in a manner that allows hits to be handled by either server in the Cluster on a dynamic basis. All hits are handled by the  Traffic Refector Server before the hit is redirected to either Server #1 or Server #2. The logic that determines which server to use is only executed once by the Traffic Refector Server at the top of the Request for the page during the <a href="00000700.htm#1188711">onRequestStart</a> method. The target server that was chosen during the <a href="00000700.htm#1188711">onRequestStart</a> method is used until the <a href="00000699.htm#1186124">onRequestEnd</a> method is executed to signal that the whole page has been fetched. In reality once the Traffic Refector Server has redirected the hit to either Server #1 or Server #2 the rest of that &quot;hit&quot; is handled entirely by that server. Image URLs are relative to the base URL. URLs for links and buttons are fully qualified and cause the Traffic Refector Server to be hit for the next &quot;page&quot; request. </p>
<p>Because the Session Scope is not being used and is not being shared between the 3 ColdFusion servers one would simply use the Client Scope instead of the Session Scope with means complex data types would not be stored in the Client Scope however complex data types could be stored in the Client Scope by causing the complex Struct to be stored serially via WDDX or a similar technique. WDDX is fast enough for such uses. </p>
<p>The Database Server is not accessible to the Internet at all for security purposes. The Database Server has one gigabit NIC. Each of the 3 ColdFusion Servers has at least 2 NICs; typically one 100 Mbps NIC for Internet connectivity and one Gigabit NIC to access the database. Database Server accesses therefore use dedicated bandwidth that is separate from Internet bandwidth. This is a departure from the typical scenario that most companies deploy in which the database is accessed using the same physical pipe as the web servers however doing so is much less efficient than the architecture described here.</p>
<p>The total cost of this server cluster is $1500 per server or $6000 total. Each server is an off the shelf desktop computer that began life as a Media Center PC, oddly enough. The Media Center TV encoder was removed and 2 Gigabit NICs were installed along with 4 GB of RAM. In each case the 4 GB of RAM cost less than $500. The software was purchased separately from Macromedia and Microsoft as-needed. </p>
